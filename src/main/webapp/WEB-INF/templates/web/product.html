<!--product.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Web | Project Group 5</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" th:href="@{/css/product.css}"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<div th:replace="~{web/header::header}"></div>

<!-- Product Header Section -->
<div class="product-header">
    <div class="small-container">
        <h1>Our Products</h1>
        <p>Discover our amazing collection of delicious food items, carefully crafted to satisfy your taste buds</p>
    </div>
</div>

<!-- Filter Section -->
<div class="filter-section">
    <div class="small-container">
        <div class="filter-container">
            <div class="search-container">
                <form action="/search" method="get">
                    <input th:value="${txtSearch}" type="text" name="text" placeholder="ðŸ” Search for delicious products...">
                    <input type="hidden" name="pagenumber" th:value="${1}">
                </form>
            </div>

            <div class="category-select">
                <select onchange="location = this.value;">
                    <option value="/product/0/page/1">All Categories</option>
                    <th:block th:each="t : ${listAllCategory}">
                        <option th:value="@{'/products/'+${t.id}+'/page/'+${1}}"
                                th:class="${t.id == targetactive ? 'selected' : ''}">
                            [[${t.name}]]
                        </option>
                    </th:block>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Products Section -->
<div class="products-section">
    <div class="small-container">
        <div class="products-grid">
            <th:block th:each="p : ${listAllProduct}">
                <div class="product-card animate-fade-in">
                    <a th:href="@{'/product-detail/'+${p.id}+'/'+${p.category.id}}">
                        <img th:src="@{'/api/uploadfile/upload/' + ${p.thumbnailPhoto}}" alt="Product Image">
                    </a>

                    <div class="product-info">
                        <h4 name="name">[[${p.name}]]</h4>

                        <div class="product-rating">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-half-o"></i>
                            <i class="fa fa-star-o"></i>
                        </div>

                        <div class="product-price" name="price">$[[${p.price}]]</div>

                        <th:block th:if="${p.amount < p.quantity}">
                            <button class="add-to-cart-btn" th:onclick="'addProductToCart(\'' + ${p.id} + '\');'">
                                Add To Cart
                            </button>
                            <input type="hidden" id="quantity" value="1">
                        </th:block>

                        <th:block th:if="${p.amount >= p.quantity}">
                            <button class="add-to-cart-btn sold-out-btn" disabled>
                                Sold Out
                            </button>
                        </th:block>
                    </div>
                </div>
            </th:block>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <th:block th:if="${isSearch}">
                <th:block th:if="${tag>1}">
                    <a th:href="@{'/search?text='+${txtSearch}+'&pagenumber='+ ${tag - 1 }}">
                        <span>&#8592;</span>
                    </a>
                </th:block>

                <th:block th:each="i : ${#numbers.sequence(1, endPage)}">
                    <a th:href="@{'/search?text='+${txtSearch}+'&pagenumber='+${i}}">
                        <span th:class="${tag == i ? 'active-btn' : ''}">[[${i}]]</span>
                    </a>
                </th:block>

                <th:block th:if="${tag<endPage}">
                    <a th:href="@{'/search?text='+${txtSearch}+'&pagenumber='+ ${tag + 1 }}">
                        <span>&#8594;</span>
                    </a>
                </th:block>
            </th:block>

            <th:block th:if="${!isSearch}">
                <th:block th:if="${tag>1}">
                    <a th:href="@{'/products/'+${targetactive }+'/page/'+ ${tag - 1 }}">
                        <span>&#8592;</span>
                    </a>
                </th:block>

                <th:block th:each="i : ${#numbers.sequence(1, endPage)}">
                    <a th:href="@{'/products/'+${targetactive}+'/page/'+${i}}">
                        <span th:class="${tag == i ? 'active-btn' : ''}">[[${i}]]</span>
                    </a>
                </th:block>

                <th:block th:if="${tag<endPage}">
                    <a th:href="@{'/products/'+${targetactive }+'/page/'+ ${tag + 1 }}">
                        <span>&#8594;</span>
                    </a>
                </th:block>
            </th:block>
        </div>
    </div>
</div>

<div th:replace="~{web/footer::footer}"></div>

<!-- JavaScript -->
<script>
    var MenuItems = document.getElementById("MenuItems");

    if (MenuItems) {
        MenuItems.style.maxHeight = "0px";
    }

    function menutoggle() {
        if (MenuItems) {
            if (MenuItems.style.maxHeight == "0px") {
                MenuItems.style.maxHeight = "200px"
            } else {
                MenuItems.style.maxHeight = "0px"
            }
        }
    }

    // Add to cart function
    function addProductToCart(id) {
        const quantity = document.getElementById('quantity').value;
        $.ajax({
            url: "/add-to-cart/" + id + "/" + quantity,
            type: "get",
            success: function(response) {
                alert(response)
            },
            error: function(xhr) {
                // Handle error
            },
        });
    }

    // Smooth animation on scroll
    document.addEventListener('DOMContentLoaded', function() {
        const productCards = document.querySelectorAll('.product-card');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in');
                }
            });
        });

        productCards.forEach((card) => {
            observer.observe(card);
        });
    });
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</body>
</html>